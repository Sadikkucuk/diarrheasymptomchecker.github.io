<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Mini Overleaf — LaTeX Editor & PDF</title>
<style>
  :root{--bg:#0b0d10;--panel:#111418;--muted:#9aa4af;--text:#e9eef3;--accent:#7cd2ff;--ok:#3cd67a;--warn:#ffcf66;--bad:#ff7a7a}
  html,body{height:100%} body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .app{display:grid;grid-template-rows:auto 1fr auto; height:100vh}
  .top{display:flex;gap:12px;align-items:center;padding:10px 14px;border-bottom:1px solid #1a1e24;background:#0e1216}
  .top h1{margin:0;font-size:16px;letter-spacing:.2px}
  .spacer{flex:1}
  .btn{background:linear-gradient(180deg,#1b2530,#141a21);color:#eaf6ff;border:1px solid #26303b;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600}
  .btn.secondary{background:#141a21}
  .btn:disabled{opacity:.55;cursor:not-allowed}
  select,input[type="text"]{background:#0f1317;color:var(--text);border:1px solid #1c2128;padding:8px 10px;border-radius:8px}
  .main{display:grid;grid-template-columns: minmax(320px,1fr) minmax(420px,1fr); gap:12px; padding:12px; min-height:0}
  .panel{background:#111418;border-radius:12px;display:flex;flex-direction:column;min-height:0;box-shadow:0 0 0 1px #1a1e24 inset}
  .panel h2{margin:10px 12px;font-size:13px;color:#cdd6df;opacity:.9}
  .row{display:flex;gap:8px;align-items:center;padding:0 12px 10px;flex-wrap:wrap}
  .hint{color:var(--muted);font-size:12px;padding:6px 12px 10px}
  #editor{flex:1;min-height:0;border-top:1px solid #1a1e24;border-bottom:1px solid #1a1e24}
  #pdf{flex:1;min-height:0;border:0;border-radius:10px;background:#0f1317;margin:10px}
  .statusbar{display:flex;gap:10px;align-items:center;padding:8px 12px;border-top:1px solid #1a1e24;background:#0e1216}
  .pill{font-size:12px;border-radius:999px;padding:2px 8px;border:1px solid #26303b}
  .ok{color:#0b2b17;background:var(--ok)}
  .warn{color:#2b230b;background:var(--warn)}
  .bad{color:#2b0b0b;background:var(--bad)}
  .log{flex:0 0 160px; background:#0f1317; color:#b8c4cf; font:12px ui-monospace,SFMono-Regular,Consolas,monospace; border-top:1px solid #1a1e24; padding:8px 12px; overflow:auto; white-space:pre-wrap}
  .tabs{display:flex; gap:8px; padding:0 12px 8px}
  .tab{border:1px solid #26303b;border-radius:999px;padding:6px 10px;cursor:pointer}
  .tab.active{background:linear-gradient(180deg,#1b2530,#141a21)}
  @media (max-width: 1100px){ .main{grid-template-columns:1fr} }
</style>
</head>
<body>
<div class="app">
  <!-- Header -->
  <div class="top">
    <h1>Mini Overleaf</h1>
    <div class="spacer"></div>
    <label>Backend&nbsp;
      <select id="backend">
        <option value="local" selected>Local (texlive.js)</option>
        <option value="remote">Remote (LaTeX.Online via URL)</option>
      </select>
    </label>
    <label id="remoteURLWrap" style="display:none;">.tex URL&nbsp;<input id="remoteURL" type="text" size="36" placeholder="https://raw.githubusercontent.com/.../main.tex"></label>
    <label id="engineWrap" style="display:none;">Engine&nbsp;
      <select id="engine">
        <option value="pdflatex" selected>pdfLaTeX</option>
        <option value="xelatex">XeLaTeX</option>
        <option value="lualatex">LuaLaTeX</option>
      </select>
    </label>
    <label>Output name&nbsp;<input id="outName" type="text" value="output.pdf" size="14"></label>
    <button class="btn" id="compileBtn" title="Ctrl/Cmd+Enter">Compile</button>
    <button class="btn secondary" id="downloadBtn">Download</button>
    <button class="btn secondary" id="shareBtn">Copy Share Link</button>
    <button class="btn secondary" id="templateBtn">Templates</button>
  </div>

  <!-- Main -->
  <div class="main">
    <!-- Editor -->
    <section class="panel">
      <h2>Editor</h2>
      <div class="row">
        <small class="hint">Ctrl/Cmd+Enter compiles • Autosaves to your browser • Monaco editor syntax highlighting</small>
      </div>
      <div id="editor"></div>
      <div class="log" id="log"></div>
    </section>

    <!-- PDF Preview -->
    <section class="panel">
      <h2>PDF Preview</h2>
      <iframe id="pdf" title="PDF"></iframe>
      <div class="hint" id="hint">
        Local mode runs TeX in your browser. If you reference images/bibs, prefer Remote mode with a public repo URL.
      </div>
    </section>
  </div>

  <!-- Footer / status -->
  <div class="statusbar">
    <span id="engineStatus" class="pill warn">Engine: loading…</span>
    <span id="compileStatus" class="pill">Ready.</span>
    <span class="spacer"></span>
    <small id="about">Inspired by Overleaf • Single-file app</small>
  </div>
</div>

<!-- Monaco Editor -->
<script>window.require = { paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.49.0/min/vs' } };</script>
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.49.0/min/vs/loader.min.js"></script>
<script>
let editor;
require(['vs/editor/editor.main'], function () {
  editor = monaco.editor.create(document.getElementById('editor'), {
    value: '',
    language: 'latex',
    theme: 'vs-dark',
    automaticLayout: true,
    fontLigatures: true,
    fontSize: 13
  });
});
</script>

<!-- LZ-String for share links -->
<script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>

<!-- texlive.js with fallback loader -->
  <script>
// Shim for old texlive.js builds that expect lowercase `promise`
if (typeof promise === "undefined" && typeof Promise !== "undefined") {
  window.promise = Promise;
}
</script>
  <!-- put these BEFORE your old pdftex.min.js -->
<script>
  // old texlive.js expects lowercase `promise`
  if (typeof window.promise === "undefined" && typeof window.Promise !== "undefined") {
    window.promise = window.Promise;
  }
</script>
<script src="https://cdn.jsdelivr.net/gh/manuels/texlive.js/pdftex.min.js"></script>

<script src="https://cdn.jsdelivr.net/gh/manuels/texlive.js/pdftex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@zauguin/texlive.js@0.4.0/pdftex.js"></script>


<script>
(function loadTexlive(){
  // We’ll try a primary CDN and a fallback. The library fetches its WASM relative to the script path.
  const urls = [
    'https://cdn.jsdelivr.net/gh/manuels/texlive.js/pdftex.min.js',
    'https://manuels.github.io/texlive.js/pdftex.min.js'
  ];
  function tryNext(i){
    if (i>=urls.length){ window.__PDFTEX_LOAD_ERROR__=true; updateEngineStatus(); return; }
    const s = document.createElement('script');
    s.src = urls[i];
    s.async = true;
    s.onload = ()=>{ window.__PDFTEX_SRC__ = urls[i]; updateEngineStatus(); };
    s.onerror = ()=> tryNext(i+1);
    document.head.appendChild(s);
  }
  tryNext(0);
})();
</script>
<script src="https://cdn.jsdelivr.net/npm/@zauguin/texlive.js@0.4.0/pdftex.js"></script>

<script>
/* --- App logic --- */
const $ = (id)=>document.getElementById(id);

const LS_KEY = 'mini-overleaf.tex';
const pdfFrame = $('pdf');
const logEl = $('log');
const backendSel = $('backend');
const remoteURLWrap = $('remoteURLWrap');
const engineWrap = $('engineWrap');
const remoteURL = $('remoteURL');
const engineSel = $('engine');
const outName = $('outName');
const compileBtn = $('compileBtn');
const downloadBtn = $('downloadBtn');
const shareBtn = $('shareBtn');
const templateBtn = $('templateBtn');
const engineStatus = $('engineStatus');
const compileStatus = $('compileStatus');

let lastDataURI = null;

// Restore from share hash or localStorage
function initContent(){
  const hash = location.hash.replace(/^#/, '');
  if (hash){
    try {
      const decoded = LZString.decompressFromEncodedURIComponent(hash);
      if (decoded){ editor.setValue(decoded); localStorage.setItem(LS_KEY, decoded); return; }
    }catch(_){}
  }
  const saved = localStorage.getItem(LS_KEY);
  editor.setValue(saved || defaultSample());
}
function saveContent(){ localStorage.setItem(LS_KEY, editor.getValue()); }
function defaultSample(){
return `\\documentclass[10pt,a4paper]{article}
% Minimal sample. Use Templates to insert your long doc.
\\usepackage{lipsum}
\\begin{document}
\\section*{Hello Mini Overleaf}
This compiles locally via texlive.js. Press \\textbf{Ctrl/Cmd+Enter}.
\\lipsum[1-2]
\\end{document}`;
}

// Update engine pill
function updateEngineStatus(){
  const ok = (typeof window.PDFTeX === 'function') && !window.__PDFTEX_LOAD_ERROR__;
  if (ok){
    engineStatus.textContent = 'Engine: texlive.js ready';
    engineStatus.className = 'pill ok';
    engineStatus.title = 'Loaded from: ' + (window.__PDFTEX_SRC__||'');
  }else if (window.__PDFTEX_LOAD_ERROR__){
    engineStatus.textContent = 'Engine: texlive.js failed (use Remote mode)';
    engineStatus.className = 'pill bad';
  }else{
    engineStatus.textContent = 'Engine: loading…';
    engineStatus.className = 'pill warn';
  }
}

// Tabs between backends
backendSel.addEventListener('change',()=>{
  const isRemote = backendSel.value === 'remote';
  remoteURLWrap.style.display = isRemote ? '' : 'none';
  engineWrap.style.display = isRemote ? '' : 'none';
});

// Compile shortcuts
document.addEventListener('keydown', (e)=>{
  if ((e.ctrlKey || e.metaKey) && e.key === 'Enter'){ e.preventDefault(); compileNow(); }
});

// Compile button
compileBtn.onclick = compileNow;

// Download button
downloadBtn.onclick = ()=>{
  if (!lastDataURI){ toast('Nothing to download yet. Compile first.'); return; }
  const a = document.createElement('a');
  a.href = lastDataURI;
  a.download = (outName.value || 'output.pdf').trim();
  document.body.appendChild(a); a.click(); a.remove();
};

// Share link
shareBtn.onclick = ()=>{
  const code = editor.getValue();
  const hash = LZString.compressToEncodedURIComponent(code);
  const url = location.origin + location.pathname + '#' + hash;
  navigator.clipboard.writeText(url).then(()=> toast('Share link copied.'), ()=> toast('Could not copy.'));
};

// Templates
templateBtn.onclick = ()=>{
  const choices = [
    {name:'(Your long sample from message)', value: longUserSample()},
    {name:'Article (barebones)', value: bareArticle()},
    {name:'Multicol Cheatsheet (simple)', value: cheatsheetTemplate()}
  ];
  const names = choices.map((c,i)=> `${i+1}. ${c.name}`).join('\n');
  const pick = prompt('Choose template:\n'+names+'\n\nType number (1-'+choices.length+')');
  const i = parseInt(pick||'',10)-1;
  if (i>=0 && i<choices.length){ editor.setValue(choices[i].value); saveContent(); }
};

// Toast in status bar
function toast(msg){ compileStatus.textContent = msg; }

// Append to log
function log(msg){ logEl.textContent += (msg + '\n'); logEl.scrollTop = logEl.scrollHeight; }

// Local compile (texlive.js)
// local compile
  <!-- replace old script with a modern build that defines TeXLive.* -->

async function compileLocal() {
  const code = editor.getValue();
  // Some builds expose a namespaced class:
  const pdftex = new TeXLive.PDFTeX();   // if this exists
  const pdf = await pdftex.compile(code, (e)=> e?.msg && log(e.msg));
  pdfFrame.src = pdf;
  lastDataURI = pdf;
}


// Remote compile (LaTeX.Online) using url= (never huge query strings)
function compileRemote(openInNew=false){
  const url = (remoteURL.value||'').trim();
  if (!url){ toast('Enter a public .tex URL.'); return; }
  const engine = engineSel.value || 'pdflatex';
  const params = new URLSearchParams({ url, command: engine });
  const endpoint = 'https://latexonline.cc/compile?' + params.toString();
  if (openInNew){
    const dl = new URL(endpoint);
    dl.searchParams.set('download', (outName.value||'output.pdf').trim());
    window.open(dl.toString(), '_blank', 'noopener');
    toast('Opened direct compile link.');
  }else{
    pdfFrame.src = endpoint;
    toast('Remote compile started (LaTeX.Online).');
  }
}

// Dispatcher
function compileNow(){
  saveContent();
  if (backendSel.value==='remote') compileRemote(false);
  else compileLocal();
}

// Secondary: remote Download
$('pdf').addEventListener('load',()=>{ /* preview loaded */ });
$('backend').dispatchEvent(new Event('change'));
updateEngineStatus();
setInterval(updateEngineStatus, 1500); // update pill while loader races
setTimeout(initContent, 400); // after Monaco boots

// Helpers: built-in templates (including YOUR long one)
function longUserSample(){ return `\\documentclass[10pt,a4paper]{article}

% Packages
\\usepackage{fancyhdr}           % For header and footer
\\usepackage{multicol}           % Allows multicols in tables
\\usepackage{tabularx}           % Intelligent column widths
\\usepackage{tabulary}           % Used in header and footer
\\usepackage{hhline}             % Border under tables
\\usepackage{graphicx}           % For images
\\usepackage{xcolor}             % For hex colours
\\usepackage[T1]{fontenc}        % Without this we get weird character replacements
\\usepackage{colortbl}           % For coloured tables
\\usepackage{setspace}           % For line height
\\usepackage{lastpage}           % Needed for total page number
\\usepackage{seqsplit}           % Splits long words.
\\usepackage[normalem]{ulem}     % For underlining links
\\usepackage{amsmath}            % Symbols
\\usepackage{MnSymbol}           % Symbols
\\usepackage{wasysym}            % Symbols

% Document Info
\\author{Skucuk}
\\pdfinfo{
  /Title (bulut-bili-im-terimleri.pdf)
  /Creator (Cheatography)
  /Author (Skucuk)
  /Subject (Bulut Bilişim Terimleri Cheat Sheet)
}

% Lengths and widths
\\addtolength{\\textwidth}{6cm}
\\addtolength{\\textheight}{-1cm}
\\addtolength{\\hoffset}{-3cm}
\\addtolength{\\voffset}{-2cm}
\\setlength{\\tabcolsep}{0.2cm}
\\setlength{\\headsep}{-12pt}
\\setlength{\\headheight}{85pt}
\\renewcommand{\\footrulewidth}{0pt}
\\renewcommand{\\headrulewidth}{0pt}
\\renewcommand{\\seqinsert}{\\ifmmode\\allowbreak\\else\\-\\fi}
\\renewcommand{\\arraystretch}{1.3}
\\onehalfspacing

% Commands
\\newcommand{\\SetRowColor}[1]{\\noalign{\\gdef\\RowColorName{#1}}\\rowcolor{\\RowColorName}}
\\newcommand{\\mymulticolumn}[3]{\\multicolumn{#1}{>{\\columncolor{\\RowColorName}}#2}{#3}}
\\newcolumntype{x}[1]{>{\\raggedright}p{#1}}
\\newcommand{\\tn}{\\tabularnewline}

% Font and Colours
\\definecolor{HeadBackground}{HTML}{333333}
\\definecolor{FootBackground}{HTML}{666666}
\\definecolor{TextColor}{HTML}{333333}
\\definecolor{DarkBackground}{HTML}{360FA3}
\\definecolor{LightBackground}{HTML}{F2F0F9}
\\renewcommand{\\familydefault}{\\sfdefault}
\\color{TextColor}

\\pagestyle{fancy}
\\fancyhead{} \\fancyfoot{}

\\begin{document}
\\raggedright
\\raggedcolumns
\\footnotesize

\\begin{multicols*}{3}
\\begin{tabularx}{5.377cm}{X}
\\SetRowColor{DarkBackground}
\\mymulticolumn{1}{x{5.377cm}}{\\bf\\textcolor{white}{Temel Tanımlar}}  \\\\
\\SetRowColor{LightBackground}
Bulut Bilişim: BT kaynaklarının internet üzerinden, ihtiyaca göre sağlanması.\\\\
\\hhline{>{\\arrayrulecolor{DarkBackground}}-}
\\end{tabularx}
\\end{multicols*}

\\end{document}`; }

function bareArticle(){ return `\\documentclass[11pt]{article}
\\usepackage[T1]{fontenc}
\\usepackage{lmodern}
\\title{My Article}
\\author{You}
\\begin{document}
\\maketitle
Hello world!
\\end{document}`; }

function cheatsheetTemplate(){ return `\\documentclass[9pt,a4paper]{article}
\\usepackage{multicol,parskip,geometry}
\\geometry{margin=10mm}
\\begin{document}
\\begin{multicols*}{3}
\\section*{Cheatsheet}
Item 1\\\\ Item 2\\\\ Item 3
\\end{multicols*}
\\end{document}`; }

// Persist editor
setInterval(saveContent, 1500);
</script>

</body>
</html>
