<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Namaz Vakitleri — Türkiye (Çevrimdışı)</title>
<meta name="description" content="Türkiye için çevrimdışı tek sayfalık uygulama: günlük namaz vakitleri (İmsak, Güneş, Öğle, İkindi, Akşam, Yatsı), bir sonraki Cuma (Öğle), Ramazan ve bayram tarihleri, kandiller. Sadece yerel kaynaklar." />
<style>
  :root{ --bg:#0b1020; --panel:#11183a; --panel2:#0f1534; --border:#233158; --text:#eaf0ff; --muted:#9db2db; --chip:#1a2555; --accent:#67d2ff; --ok:#18c964; --warn:#ffd166; --bad:#ff6b6b }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;background:radial-gradient(1200px 700px at 70% -10%,#16205b 0,#0b1020 60%,#0b1020 100%);color:var(--text)}
  header{position:sticky;top:0;z-index:10;background:#0c1334e6;backdrop-filter:blur(8px);border-bottom:1px solid var(--border);padding:14px 16px}
  h1{margin:0;font-size:clamp(20px,3vw,28px)}
  .tag{margin:6px 0 0;color:var(--muted)}
  main{max-width:1100px;margin:0 auto;padding:14px;display:grid;gap:12px}
  .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:12px}
  .grid{display:grid;gap:12px}
  .two{grid-template-columns:1.1fr 1fr}
  @media(max-width:980px){ .two{grid-template-columns:1fr} }
  label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px}
  input,select,button{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#0e1640;color:var(--text);font-size:14px}
  button{cursor:pointer}
  .btn{background:linear-gradient(180deg,#67d2ff,#2aa4ef);border:none;color:#00111e;font-weight:700}
  .ghost{background:transparent;border:1px dashed var(--border);color:var(--muted)}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .chip{background:var(--chip);border:1px solid var(--border);padding:6px 10px;border-radius:999px;color:var(--muted);font-size:12px}
  .right{margin-left:auto}
  .small{font-size:12px;color:var(--muted)}
  table{width:100%;border-collapse:separate;border-spacing:0}
  th,td{padding:10px;border-bottom:1px solid var(--border);text-align:left;font-size:13px}
  thead th{position:sticky;top:0;background:#121a45;z-index:1}
  tbody tr:hover{background:#0f183b}
  details{border:1px solid var(--border);border-radius:12px;overflow:hidden}
  details>summary{cursor:pointer;padding:10px 14px;background:#111a3f;color:var(--text);list-style:none}
  details>div{padding:14px}
</style>
</head>
<body>
<header>
  <h1>Namaz Vakitleri — Türkiye (Çevrimdışı)</h1>
  <p class="tag">Konum seç, bugünkü vakitleri gör. Cuma (Öğle), Ramazan ve bayramlar, kandiller. İnternetsiz, sadece yerel kod.</p>
</header>

<main class="grid two">
  <section class="card">
    <div class="row">
      <div style="flex:1 1 360px;min-width:260px">
        <label>Konum (Şehir adıyla ara veya enlem/boylam gir)</label>
        <input id="place" list="sehirler" placeholder="İstanbul veya 41.0082, 28.9784" />
        <datalist id="sehirler"></datalist>
        <div class="row" style="gap:6px;margin-top:6px">
          <button id="useLoc" class="ghost">📍 Konumumu kullan</button>
          <span class="chip">Seçilen: <b id="latlon">—</b></span>
          <span class="chip">Zaman dilimi: <b id="tz">TRT (UTC+3)</b></span>
        </div>
      </div>
      <div style="width:180px">
        <label>Tarih</label>
        <input id="date" type="date" />
      </div>
      <div style="width:220px">
        <label>Hesaplama yöntemi</label>
        <select id="method">
          <option value="diyanet" selected>Diyanet (Türkiye) — İmsak 18°, Yatsı 17°</option>
          <option value="mwl">MWL — 18° / 17°</option>
        </select>
      </div>
      <div style="width:180px">
        <label>İkindi mezhebi</label>
        <select id="madhab">
          <option value="hanafi" selected>Hanefî (gölge 2)</option>
          <option value="shafi">Şafiî (gölge 1)</option>
        </select>
      </div>
      <div style="width:140px;align-self:end">
        <button id="refresh" class="btn">↻ Güncelle</button>
      </div>
    </div>

    <div class="card" style="background:var(--panel2);margin-top:10px">
      <div class="row"><b>Bugünün Namaz Vakitleri</b><span class="right" id="todayLabel"></span></div>
      <table id="ptbl">
        <thead><tr><th>Vakit</th><th>Saat</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card" style="background:var(--panel2)">
      <div class="row"><b>Sonraki Cuma Namazı (Öğle)</b><span class="right small" id="friLabel">—</span></div>
      <div class="row" id="friTime" style="font-family:ui-monospace,monospace;font-size:18px">—</div>
    </div>
  </section>

  <section>
    <div class="card">
      <div class="row"><b>Önemli Tarihler — <span id="yearLabel">—</span></b><span class="right small">(tablo Hicrî — ±1 gün değişebilir)</span></div>
      <table id="holidayTbl">
        <thead><tr><th>Etkinlik</th><th>Tarih</th></tr></thead>
        <tbody></tbody>
      </table>
      <div class="small" style="margin-top:6px">Not: Resmî duyurular hilal tespitine göre farklı olabilir. Ramazan Bayramı = Eid al‑Fitr, Kurban Bayramı = Eid al‑Adha.</div>
    </div>

    <div class="card">
      <details>
        <summary>Bilgi</summary>
        <div class="small">
          <ul>
            <li>Hesap tümüyle tarayıcınızda yapılır; internet bağlantısı gerekmez.</li>
            <li>Türkiye tek zaman dilimi (TRT, UTC+3) kabul edilmiştir.</li>
            <li>İmsak/Yatsı açıları: Diyanet için sırasıyla <b>18°</b> ve <b>17°</b>.</li>
            <li>Kandiller: Regaip Kandili (Receb'in ilk cuma gecesi), Miraç (27 Receb), Berat (15 Şaban), Kadir (27 Ramazan), Mevlid (12 Rebîülevvel).</li>
          </ul>
        </div>
      </details>
    </div>
  </section>
</main>

<script>
(function(){
  // ========= Yardımcılar =========
  const $$ = s=>document.querySelector(s);
  const $t = (tag,props={})=>Object.assign(document.createElement(tag),props);
  const todayISO = ()=> new Date().toISOString().slice(0,10);
  const TRT_OFFSET = 3; // Türkiye sabit UTC+3
  const toHM = d=> d==null? '—' : `${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;

  // ========= Yerel şehir listesi (örnek: 60+ büyük il) =========
  const CITIES = [
    ['Adana',37.0000,35.3213],['Adıyaman',37.7640,38.2773],['Afyonkarahisar',38.7560,30.5387],['Ağrı',39.7191,43.0503],['Aksaray',38.3680,34.0380],
    ['Amasya',40.6539,35.8331],['Ankara',39.9208,32.8541],['Antalya',36.8969,30.7133],['Ardahan',41.1105,42.7022],['Artvin',41.1810,41.8226],
    ['Aydın',37.8450,27.8396],['Balıkesir',39.6484,27.8826],['Bartın',41.6344,32.3375],['Batman',37.8812,41.1351],['Bayburt',40.2583,40.2270],
    ['Bilecik',40.1419,29.9793],['Bingöl',38.8853,40.4983],['Bitlis',38.4011,42.1078],['Bolu',40.7350,31.6116],['Burdur',37.7219,30.2857],
    ['Bursa',40.1950,29.0600],['Çanakkale',40.1467,26.4086],['Çankırı',40.6013,33.6134],['Çorum',40.5506,34.9556],['Denizli',37.7765,29.0864],
    ['Diyarbakır',37.9144,40.2306],['Düzce',40.8438,31.1565],['Edirne',41.6771,26.5559],['Elazığ',38.6760,39.2220],['Erzincan',39.7505,39.5009],
    ['Erzurum',39.9043,41.2679],['Eskişehir',39.7667,30.5256],['Gaziantep',37.0662,37.3833],['Giresun',40.9128,38.3895],['Gümüşhane',40.4603,39.4814],
    ['Hakkari',37.5744,43.7408],['Hatay',36.2023,36.1604],['Iğdır',39.9237,44.0450],['Isparta',37.7648,30.5566],['İstanbul',41.0082,28.9784],
    ['İzmir',38.4237,27.1428],['Kahramanmaraş',37.5753,36.9381],['Karabük',41.1960,32.6227],['Karaman',37.1811,33.2150],['Kars',40.6013,43.0962],
    ['Kastamonu',41.3887,33.7827],['Kayseri',38.7225,35.4875],['Kırıkkale',39.8468,33.5153],['Kırklareli',41.7355,27.2253],['Kırşehir',39.1461,34.1590],
    ['Kilis',36.7161,37.1147],['Kocaeli',40.7667,29.9167],['Konya',37.8713,32.4846],['Kütahya',39.4242,29.9833],['Malatya',38.3552,38.3095],
    ['Manisa',38.6191,27.4289],['Mardin',37.3120,40.7350],['Mersin',36.8121,34.6415],['Muğla',37.2153,28.3636],['Muş',38.7439,41.5064],
    ['Nevşehir',38.6247,34.7140],['Niğde',37.9667,34.6833],['Ordu',40.9862,37.8797],['Osmaniye',37.0747,36.2466],['Rize',41.0201,40.5234],
    ['Sakarya',40.7731,30.3948],['Samsun',41.2867,36.3300],['Siirt',37.9333,41.9500],['Sinop',42.0264,35.1555],['Sivas',39.7480,37.0170],
    ['Şanlıurfa',37.1674,38.7955],['Şırnak',37.5210,42.4562],['Tekirdağ',40.9780,27.5110],['Tokat',40.3167,36.5500],['Trabzon',41.0015,39.7178],
    ['Tunceli',39.1060,39.5480],['Uşak',38.6730,29.4050],['Van',38.4940,43.3800],['Yalova',40.6550,29.2820],['Yozgat',39.8200,34.8147],
    ['Zonguldak',41.4564,31.7987]
  ];

  // Şehir listesi datalist'e yükle
  const dl=$$('#sehirler'); CITIES.forEach(c=> dl.appendChild($t('option',{value:c[0]})));

  // ========= Güneş ve namaz hesabı (PrayTimes yaklaşımı) =========
  const d2r = x=> x*Math.PI/180, r2d = x=> x*180/Math.PI, fixAngle = a=> (a%360+360)%360;
  function julian(date){ // UTC gün ortası JD
    const y=date.getUTCFullYear(), m=date.getUTCMonth()+1, d=date.getUTCDate();
    const a = Math.floor((14 - m)/12), y2 = y + 4800 - a, m2 = m + 12*a - 3;
    let J = d + Math.floor((153*m2 + 2)/5) + 365*y2 + Math.floor(y2/4) - Math.floor(y2/100) + Math.floor(y2/400) - 32045;
    return J;
  }
  function sunPosition(jd){
    const D = jd - 2451545.0;
    const g = d2r(fixAngle(357.529 + 0.98560028*D));
    const q = fixAngle(280.459 + 0.98564736*D);
    const L = d2r(fixAngle(q + 1.915*Math.sin(g) + 0.020*Math.sin(2*g)));
    const e = d2r(23.439 - 0.00000036*D);
    const RA = Math.atan2(Math.cos(e)*Math.sin(L), Math.cos(L));
    const eqt = (q/15) - (r2d(RA)/15);
    const decl = Math.asin(Math.sin(e)*Math.sin(L));
    return {decl, eqt}; // eqt saat cinsinden
  }
  function hourAngle(lat, decl, alt){
    const num = Math.sin(alt) - Math.sin(lat)*Math.sin(decl);
    const den = Math.cos(lat)*Math.cos(decl);
    const x = num/den; if(x<-1) return Math.acos(-1); if(x>1) return 0; // koruma
    return Math.acos(x); // radyan
  }
  function computePrayerTimes(dateLocal, latDeg, lonDeg, method, madhab){
    // dateLocal: yerel TRT tarihi
    const tz = TRT_OFFSET; // saat
    // UTC'ye karşılık gelen tarih için JD
    const dateUTC = new Date(Date.UTC(dateLocal.getFullYear(), dateLocal.getMonth(), dateLocal.getDate()));
    const jd = julian(dateUTC);
    const {decl, eqt} = sunPosition(jd);
    const lat = d2r(latDeg);
    const lon = lonDeg;
    const noon = 12 + tz - lon/15 - eqt; // saat cinsinden
    const altSun = d2r(-0.833); // güneş diski
    const fajrAng = d2r(method==='diyanet'? -18 : -18);
    const ishaAng = d2r(method==='diyanet'? -17 : -17);
    const Hsun = r2d(hourAngle(lat, decl, altSun))/15;
    const Hfajr = r2d(hourAngle(lat, decl, fajrAng))/15;
    const Hisha = r2d(hourAngle(lat, decl, ishaAng))/15;
    // Asr
    const k = (madhab==='hanafi')? 2 : 1;
    const a_asr = Math.atan(1/(k + Math.tan(Math.abs(lat - decl))));
    const Hasr = r2d(hourAngle(lat, decl, a_asr))/15;
    function toDate(hours){ const h = Math.floor(hours), m = Math.round((hours - h)*60); const d=new Date(dateLocal); d.setHours(h,m,0,0); return d; }
    return {
      imsak: toDate(noon - Hfajr),
      gunes: toDate(noon - Hsun),
      ogle:  toDate(noon),
      ikindi:toDate(noon + Hasr),
      aksam: toDate(noon + Hsun),
      yatsi: toDate(noon + Hisha)
    };
  }

  // ========= Hicrî (tablo) ve önemli tarihler =========
  const IS_EPOCH = 1948439.5, GR_EPOCH = 1721425.5;
  const isLeapG = y=> (y%4===0 && y%100!==0) || (y%400===0);
  function g2jd(y,m,d){ return (GR_EPOCH -1) + 365*(y-1) + Math.floor((y-1)/4) - Math.floor((y-1)/100) + Math.floor((y-1)/400) + Math.floor((367*m - 362)/12 + (m<=2?0:(isLeapG(y)?-1:-2)) + d); }
  function jd2g(jd){ const w = Math.floor(jd-0.5)+0.5, depo = w-GR_EPOCH, qc=Math.floor(depo/146097), dqc=depo%146097, c=Math.floor(dqc/36524), dc=dqc%36524, q=Math.floor(dc/1461), dq=dc%1461, yi=Math.floor(dq/365); let y=qc*400+c*100+q*4+yi; if(!(c===4||yi===4)) y++; const yearday=w-g2jd(y,1,1)+1; const leap=isLeapG(y)?1:0; const m = yearday<=31+28+leap? Math.floor((12*(yearday-1)+373)/367) : Math.floor((12*(yearday-59-leap)+306)/367)+3; const day = w-g2jd(y,m,1)+1; return {y,m,d:day}; }
  function i2jd(y,m,d){ return (d + Math.ceil(29.5*(m-1)) + (y-1)*354 + Math.floor((3+11*y)/30) + IS_EPOCH) -1; }
  function jd2i(jd){ const j0=Math.floor(jd)+0.5; const y=Math.floor((30*(j0-IS_EPOCH)+10646)/10631); const m=Math.min(12, Math.ceil((j0 - (29 + i2jd(y,1,1)))/29.5)+1); const d=j0 - i2jd(y,m,1) + 1; return {y,m,d}; }
  function i2gDate(y,m,d){ const g=jd2g(i2jd(y,m,d)); return new Date(Date.UTC(g.y, g.m-1, g.d)); }
  function g2iDate(date){ const jd = Math.floor(date.getTime()/86400000) + 2440587.5; return jd2i(jd); }

  function keyDatesForYearTR(gy){
    const hJan = g2iDate(new Date(Date.UTC(gy,0,1))).y; const cand=[hJan-1,hJan,hJan+1];
    const out=[]; const add=(ad,dt)=>{ if(dt.getUTCFullYear()===gy) out.push([ad, dt]); };
    for(const hy of cand){
      const ram1 = i2gDate(hy,9,1); const shaw1 = i2gDate(hy,10,1); const ramEnd = new Date(shaw1.getTime()-86400000);
      add('Ramazan başlangıcı', ram1);
      add('Ramazan bitişi', ramEnd);
      add('Ramazan Bayramı (1. gün)', shaw1);
      add('Ramazan Bayramı (3. gün sonu)', i2gDate(hy,10,3));
      add('Kurban Bayramı (1. gün)', i2gDate(hy,12,10));
      add('Kurban Bayramı (4. gün sonu)', i2gDate(hy,12,13));
      // Kandiller
      // Regaip: Receb ayındaki ilk Cuma gecesi (Perşembe akşamı tarihi)
      let firstFri=null; for(let d=1; d<=7; d++){ const g=i2gDate(hy,7,d); if(g.getUTCDay()===5){ firstFri=d; break; } }
      if(firstFri){ const thu=i2gDate(hy,7,firstFri-1); add('Regaip Kandili', thu); }
      add('Miraç Kandili (27 Receb)', i2gDate(hy,7,27));
      add('Berat Kandili (15 Şaban)', i2gDate(hy,8,15));
      add('Kadir Gecesi (27 Ramazan)', i2gDate(hy,9,27));
      add('Mevlid Kandili (12 Rebîülevvel)', i2gDate(hy,3,12));
    }
    out.sort((a,b)=>a[1]-b[1]);
    return out;
  }

  // ========= Arayüz =========
  const state = {lat:41.0082, lon:28.9784, method:'diyanet', madhab:'hanafi'};
  $$('#date').value = todayISO();
  $$('#latlon').textContent = `${state.lat.toFixed(4)}, ${state.lon.toFixed(4)}`;

  // Konum arama: şehir adına eşle veya enlem,boylam
  $$('#place').addEventListener('change', ()=>{ applyPlace($$('#place').value.trim()); });
  function applyPlace(val){
    if(!val) return;
    const m = val.match(/^\s*([+-]?\d+(?:\.\d+)?)\s*,\s*([+-]?\d+(?:\.\d+)?)\s*$/);
    if(m){ state.lat=Number(m[1]); state.lon=Number(m[2]); updateAll(); return; }
    const rec = CITIES.find(c=> c[0].toLowerCase()===val.toLowerCase());
    if(rec){ state.lat=rec[1]; state.lon=rec[2]; updateAll(); }
  }

  // Tarayıcı konumu (çevrimdışı)
  $$('#useLoc').addEventListener('click', ()=>{
    if(!navigator.geolocation){ alert('Tarayıcınız konum erişimini desteklemiyor.'); return; }
    navigator.geolocation.getCurrentPosition(pos=>{ state.lat=pos.coords.latitude; state.lon=pos.coords.longitude; updateAll(); }, err=> alert('Konum alınamadı: '+err.message), {enableHighAccuracy:true, timeout:10000, maximumAge:60000});
  });

  $$('#method').addEventListener('change', ()=>{ state.method=$$('#method').value; updateAll(); });
  $$('#madhab').addEventListener('change', ()=>{ state.madhab=$$('#madhab').value; updateAll(); });
  $$('#date').addEventListener('change', updateAll);
  $$('#refresh').addEventListener('click', updateAll);

  function updateAll(){
    const date = new Date($$('#date').value||todayISO());
    const t = computePrayerTimes(date, state.lat, state.lon, state.method, state.madhab);
    $$('#latlon').textContent = `${state.lat.toFixed(4)}, ${state.lon.toFixed(4)}`;
    // Tablo
    const tz = 'tr-TR';
    $$('#todayLabel').textContent = date.toLocaleDateString(tz,{weekday:'long', year:'numeric', month:'long', day:'numeric'});
    const tb = $$('#ptbl tbody'); tb.innerHTML='';
    const rows = [ ['İmsak', t.imsak], ['Güneş', t.gunes], ['Öğle', t.ogle], ['İkindi', t.ikindi], ['Akşam', t.aksam], ['Yatsı', t.yatsi] ];
    rows.forEach(r=>{ const tr=$t('tr'); tr.appendChild($t('td',{textContent:r[0]})); tr.appendChild($t('td',{textContent:toHM(r[1])})); tb.appendChild(tr); });
    // Cuma (bir sonraki cuma günü Öğle vakti)
    const d0 = new Date(date); const add = (5 - d0.getDay() + 7) % 7; const fri = new Date(d0.getFullYear(), d0.getMonth(), d0.getDate()+add);
    const tf = computePrayerTimes(fri, state.lat, state.lon, state.method, state.madhab);
    $$('#friTime').textContent = `Cuma = Öğle ${toHM(tf.ogle)}`;
    $$('#friLabel').textContent = fri.toLocaleDateString(tz,{weekday:'long', year:'numeric', month:'long', day:'numeric'});
    // Önemli tarihler
    const gy = date.getFullYear(); $$('#yearLabel').textContent = gy;
    const list = keyDatesForYearTR(gy);
    const tb2 = $$('#holidayTbl tbody'); tb2.innerHTML='';
    list.forEach(([ad,dt])=>{ if(dt.getUTCFullYear()===gy){ const tr=$t('tr'); tr.appendChild($t('td',{textContent:ad})); const loc = new Date(Date.UTC(dt.getUTCFullYear(), dt.getUTCMonth(), dt.getUTCDate())); tr.appendChild($t('td',{textContent: loc.toLocaleDateString('tr-TR',{weekday:'long', year:'numeric', month:'long', day:'numeric'}) })); tb2.appendChild(tr); } });
  }

  // Başlangıç
  updateAll();
})();
</script>
</body>
</html>
