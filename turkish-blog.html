<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Türkçe Blog Arşivi</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;margin:0;padding:2rem;line-height:1.5}
h1{margin:0 0 1rem}
.controls{display:flex;gap:.5rem;flex-wrap:wrap;margin:0 0 1rem}
input[type="search"]{padding:.6rem .8rem;border:1px solid #ddd;border-radius:.6rem;min-width:240px}
.grid{display:grid;gap:1rem;grid-template-columns:repeat(auto-fill,minmax(280px,1fr))}
.card{border:1px solid #eee;border-radius:.9rem;overflow:hidden;background:#fff;display:flex;flex-direction:column}
.thumb{width:100%;height:180px;object-fit:cover;background:#f6f6f6}
.card-content{padding:.9rem}
.card h2{font-size:1.05rem;margin:.2rem 0 .4rem;line-height:1.3}
.card p{margin:0;color:#555}
.meta{font-size:.85rem;color:#888;margin-top:.4rem}
footer{margin-top:2rem;color:#888;font-size:.85rem}
</style>
</head>
<body>
<h1>Türkçe Blog Arşivi</h1>
<div class="controls">
  <input id="q" type="search" placeholder="Ara (başlık / açıklama)..." />
  <span id="count" class="meta"></span>
</div>
<div id="list" class="grid" aria-live="polite"></div>
<footer>Bu liste otomatik olarak <code>/tr</code> klasöründeki HTML sayfalardan üretilir.</footer>

<script>
const LIST_JSON = "/tr-index.json";   // workflow’un ürettiği manifest
const container = document.getElementById("list");
const countEl   = document.getElementById("count");
const searchEl  = document.getElementById("q");
let ALL = [];

function render(list){
  countEl.textContent = `${list.length} yazı`;
  container.innerHTML = list.map(p=>`
    <article class="card">
      <a href="${p.link}">
        ${p.img ? `<img class="thumb" src="${p.img}" alt="${p.title}">` : `<div class="thumb" aria-hidden="true"></div>`}
        <div class="card-content">
          <h2>${p.title.replace(/[&<>"]/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;", '"':"&quot;" }[m]))}</h2>
          ${p.desc ? `<p>${p.desc}</p>` : ""}
          ${p.date ? `<div class="meta">${p.date}</div>` : ""}
        </div>
      </a>
    </article>
  `).join("");
}

(async ()=>{
  container.innerHTML = "<p>Yükleniyor…</p>";
  try{
    const res = await fetch(LIST_JSON, {cache:"no-store"});
    if(!res.ok) throw new Error(`Manifest ${res.status}`);
    ALL = await res.json();
    render(ALL);
  }catch(e){
    container.innerHTML = `<p>Liste alınamadı: ${e.message}</p>`;
  }
})();

searchEl?.addEventListener("input", e=>{
  const q = e.target.value.trim().toLowerCase();
  render(q ? ALL.filter(p => (p.title+p.desc).toLowerCase().includes(q)) : ALL);
});
</script>


</body>
</html>
